model AIChat {
    id                 String   @unique
    userId             String
    title              String   @default("")
    activeDocumentId   String? // UserStorage ID of active document for RAG
    activeDocumentName String? // File name for display
    createdAt          DateTime @default(now())
    updatedAt          DateTime @default(now()) @updatedAt

    user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)
    messages AIChatMessage[]

    @@index([userId, updatedAt(sort: Desc)])
}

model AIChatMessage {
    id           String   @unique
    chatId       String
    role         String // "user" | "assistant"
    content      String
    imageUrl     String? // URL ảnh nếu có upload
    documentId   String? // ID của UserStorage nếu dùng PDF context
    documentName String? // Tên file để hiển thị
    createdAt    DateTime @default(now())

    chat AIChat @relation(fields: [chatId], references: [id], onDelete: Cascade)

    @@index([chatId, createdAt])
}
